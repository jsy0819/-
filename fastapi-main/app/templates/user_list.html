<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원 리스트</title>
    <link rel="icon" href="/static/favicon.ico">
    <style>
        body{margin:0;}
        .container{
            max-width: 900px;
            margin:2rem auto;
            padding : 2rem;
            background-color: #fff;
        }
        h1{
            text-align: center;
            font-size: 24px;
            margin-bottom: 20px;
        }
        table{
            border-collapse: collapse;
        }
        th{
            background-color: #ecf1fd;
            padding: 5px;
        }
        td{
            padding: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>회원 리스트</h1>
        <table border="1" width="100%">
            <tr>
                <th>아이디</th>
                <th>이름</th>
                <th>이메일</th>
                <th>수정/삭제<button style="margin-left: 10px;" onclick="javascript:location.href='/register/'">회원추가</button></th>
            </tr>
            {% if users %}
                {% for user in users %}
            <tr>
                <td>{{user.id}}</td>
                <td><a href="/users/{{user.id}}">{{user.username}}</a></td>
                <td>{{user.email}}</td>
                <td style="text-align: center;"><button style="margin-left: 10px;" onclick="javascript:location.href='/users/{{user.id}}/edit'">회원수정</button>
                <button style="margin-left: 10px;" onclick="deleteUser({{user.id}})">회원삭제</button>
                <button style="margin-left: 10px;" onclick="javascript:location.href='/posts/create/{{user.id}}'">글 작성</button></td>
            </tr>
                {% endfor %}
            {% endif %}
        </table>
    </div>
    <script>
        async function deleteUser(userID){
            if(!confirm(`진짜 ${userID} 아이디를 삭제하시겠습니까?`)){
                console.log('ok 삭제 "안"할 거야');
                return;
            }
            console.log('ok 삭제할 거야');
            try{
                const response = await fetch(`/users/${userID}`, {
                    method: 'DELETE'
                });
                if(response.status === 204){
                    alert('회원 정보 삭제 완료!');
                    window.location.reload();
                }else{
                    const error = await response.json();
                    alert(`회원 정보 삭제 실패 : ${error.detail}`);
                }

            }catch(error){
                alert(`알 수 없는 에러가 나타났습니다. ${error}`)
            }
        }
    </script>
</body>
</html>